# Web-Ларёк (Backend на Express + TypeScript)

## Описание проекта

**Web-Ларёк** реализует серверную часть онлайн-витрины. Приложение написано на **Node.js (Express)** с использованием **TypeScript** и построено по принципам модульной архитектуры.

Проект состоит из двух веток:

1. **`main`** — базовый REST API для получения списка товаров и оформления заказов (без авторизации).
2. **`admin`** — расширенная версия с административным функционалом: добавление, редактирование и удаление товаров, а также авторизация пользователей.

---

## Основной функционал (ветка `main`)

### Продукты

- Получение списка всех товаров (`GET /product`)
- Подсчёт общего количества товаров
- Данные каждого товара включают: название, категорию, описание, цену и изображение

### Заказы

- Создание заказа (`POST /order`)
- Проверка наличия всех товаров в заказе
- Проверка, что сумма заказа (`total`) совпадает с ценами товаров
- Автоматическая генерация уникального `id` заказа с помощью **faker**
- Возврат объекта `{ id, total }` при успешном заказе

### Валидация данных

- Используется **celebrate + Joi** для проверки входящих данных (обязательные поля, типы данных, корректный email и т.д.)
- Единый формат ошибок валидации

### Обработка ошибок

- Централизованный middleware для ошибок
- Стандартизированные классы ошибок:
  - `BadRequestError`
  - `ConflictError`
  - `NotFoundError`
  - `UnauthorizedError` (используется только во второй ветке)
- Унифицированный формат ответа:
  ```json
  { "message": "Описание ошибки" }
  ```

Логирование

- Все запросы и ошибки логируются в файлы request.log и error.log через express-winston
- Логи сохраняются в формате JSON

## Расширенная версия (ветка admin)

### Админ-панель добавляет полноценное управление товарами и авторизацию пользователей.

### Новый функционал

- Регистрация и вход пользователя по email и паролю
- JWT-аутентификация (access + refresh токены)
- Обновление и выход из системы через refresh-токен в cookie
- Добавление нового товара (POST /product)
- Редактирование товара (PATCH /product/:id)
- Удаление товара (DELETE /product/:id)
- Доступ к CRUD-операциям защищён middleware-ом auth

### Дополнительно

- Хеширование паролей через bcryptjs
- Загрузка изображений с помощью multer
- Временное хранилище /temp и постоянное /images
- Автоматическое создание директорий при запуске сервера
- Проверка допустимых форматов изображений и ограничение размера файла

## Технологический стек

| Категория                | Технологии               |
| ------------------------ | ------------------------ |
| **Язык**                 | TypeScript               |
| **Сервер**               | Express                  |
| **База данных**          | MongoDB (Mongoose)       |
| **Валидация**            | Celebrate, Joi           |
| **Логирование**          | Winston, express-winston |
| **Работа с файлами**     | Multer                   |
| **Переменные окружения** | dotenv                   |
| **Тестирование API**     | Postman / Newman         |

> Ветка **`admin`** также использует:
>
> - `bcryptjs` — для хеширования паролей
> - `jsonwebtoken` — для генерации access и refresh токенов
> - `cookie-parser` — для работы с куками при авторизации

## Запуск проекта

### 1. Установка зависимостей

    ```bash
        npm install

### 2. Настройка переменных окружения

Создайте файл .env в корне проекта, скопировав .env.example

### 3. Запуск сервера

```bash
   	npm run dev
		npm run start
```
